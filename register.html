<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>রেজিস্ট্রেশন - Income White HQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    html, body {height: auto !important; min-height: 100vh; overflow-y: auto !important; -webkit-overflow-scrolling: touch; padding: 20px 0 120px 0;}
    body {font-family: 'Segoe UI', Arial, sans-serif; background: #0a001f; color: #fff; position: relative;}
    canvas {position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;}
    .container {max-width: 420px; margin: 20px auto; padding: 20px;}
    .box {background: rgba(255,255,255,0.95); backdrop-filter: blur(15px); border-radius: 25px; padding: 35px 30px; box-shadow: 0 25px 60px rgba(0,212,255,0.4); border: 3px solid #00d4ff; color: #333;}
    h2 {color: #00d4ff; text-align: center; margin-bottom: 30px; font-size: 32px; font-weight: 900;}
    input {width: 100%; padding: 18px; margin: 12px 0; border: 2px solid #ddd; border-radius: 15px; font-size: 17px; background: #fff; transition: 0.3s;}
    input:focus {border-color: #00d4ff; outline: none; box-shadow: 0 0 20px rgba(0,212,255,0.4);}
    input[readonly] {background: #e8f8ff; color: #0066cc; font-weight: bold;}
    button {background: linear-gradient(135deg,#00d4ff,#00ff9d); color: #000; padding: 20px; border: none; border-radius: 18px; width: 100%; font-size: 20px; font-weight: 900; margin-top: 25px; cursor: pointer; box-shadow: 0 12px 35px rgba(0,212,255,0.5); transition: 0.4s;}
    button:hover {transform: translateY(-5px);}
    button:disabled {background: #999; cursor: not-allowed; transform: none;}
    .error {color: #ff1744; text-align: center; margin: 15px 0; font-weight: bold; font-size: 17px; padding: 10px; background: rgba(255,23,68,0.1); border-radius: 10px;}
    .login-link {text-align: center; margin-top: 20px; font-size: 16px;}
    .login-link a {color: #00d4ff; font-weight: bold; text-decoration: none;}
    .popup {position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 9999; padding: 20px;}
    .popbox {background: #fff; border-radius: 25px; padding: 35px; max-width: 400px; width: 100%; text-align: center; border: 4px solid #00d4ff;}
    .link {background: #f0f8ff; padding: 18px; border-radius: 15px; margin: 18px 0; word-break: break-all; font-family: monospace; font-size: 15px; color: #0066cc; font-weight: bold;}
  </style>
</head>
<body>

<canvas id="spaceBg"></canvas>

<div class="container">
  <div class="box">
    <h2>রেজিস্ট্রেশন করুন</h2>
    <div class="error" id="msg"></div>

    <input type="text" id="firstName" placeholder="ফার্স্ট নেম *" required>
    <input type="text" id="lastName" placeholder="লাস্ট নেম *" required>
    <input type="text" id="phone" placeholder="মোবাইল নাম্বার (017...) *" maxlength="11" required>
    <input type="text" id="username" placeholder="ইউজারনেম (ইউনিক) *" required>
    <input type="email" id="email" placeholder="ইমেইল (অপশনাল)">
    <input type="password" id="pass" placeholder="পাসওয়ার্ড (৬+ অক্ষর) *" minlength="6" required>
    <input type="password" id="cpass" placeholder="কনফার্ম পাসওয়ার্ড *" required>
    <input type="text" id="refCode" placeholder="রেফার কোড (অপশনাল) → ১০০ HQ বোনাস" readonly>

    <button id="regBtn" onclick="register()">রেজিস্টার করুন</button>

    <div class="login-link">
      ইতিমধ্যে একাউন্ট আছে? <a href="login.html">লগইন করুন</a>
    </div>
  </div>
</div>

<!-- সাকসেস পপআপ -->
<div class="popup" id="success">
  <div class="popbox">
    <h3 style="color:#00d4ff;margin-bottom:20px;font-size:26px">অভিনন্দন!<br>রেজিস্ট্রেশন সফল!</h3>
    <p style="margin-bottom:15px;font-size:17px">তোমার লগইন তথ্য:</p>
    <div class="link" id="loginInfo"></div>
    <p style="margin:25px 0 15px;font-size:17px">তোমার রেফার লিংক:</p>
    <div class="link" id="myRefLink"></div>
    <button onclick="copyLink()" style="background:#00d4ff;color:#fff;padding:14px;border-radius:12px;margin:10px;font-size:17px;font-weight:bold;width:100%">রেফার লিংক কপি করুন</button>
    <button onclick="goDashboard()" style="background:#8b3dff;color:#fff;padding:18px;border-radius:15px;margin-top:15px;font-size:19px;font-weight:900;width:100%">ড্যাশবোর্ডে যান</button>
  </div>
</div>

<script>
// তোমার Xano URL — ১০০% ঠিক
const BASE_URL = "https://x8ki-letl-twmt.n7.xano.io/api:wsicKubT";

// রেফার কোড URL থেকে লোড
const urlParams = new URLSearchParams(window.location.search);
const urlRef = urlParams.get('ref');
if (urlRef) {
  document.getElementById('refCode').value = urlRef.toLowerCase();
}

async function register() {
  const msg = document.getElementById('msg');
  const btn = document.getElementById('regBtn');
  msg.innerHTML = '';
  btn.disabled = true;
  btn.innerText = 'রেজিস্টার হচ্ছে...';

  const firstName = document.getElementById('firstName').value.trim();
  const lastName = document.getElementById('lastName').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const username = document.getElementById('username').value.trim().toLowerCase();
  const email = document.getElementById('email').value.trim();
  const pass = document.getElementById('pass').value;
  const cpass = document.getElementById('cpass').value;
  const refer_code = document.getElementById('refCode').value.trim() || null;

  // ভ্যালিডেশন
  if (!firstName || !lastName || !phone || !username || !pass || !cpass) {
    msg.innerHTML = 'সব * চিহ্নিত ফিল্ড পূরণ করো!';
    btn.disabled = false; btn.innerText = 'রেজিস্টার করুন'; return;
  }
  if (pass !== cpass) { msg.innerHTML = 'পাসওয়ার্ড মিলছে না!'; btn.disabled = false; btn.innerText = 'রেজিস্টার করুন'; return; }
  if (pass.length < 6) { msg.innerHTML = 'পাসওয়ার্ড কমপক্ষে ৬ অক্ষর হতে হবে!'; btn.disabled = false; btn.innerText = 'রেজিস্টার করুন'; return; }
  if (!/^01[0-9]{9}$/.test(phone)) { msg.innerHTML = 'সঠিক ১১ ডিজিটের মোবাইল নাম্বার দাও!'; btn.disabled = false; btn.innerText = 'রেজিস্টার করুন'; return; }

  try {
    const response = await fetch(BASE_URL + "/Register_User", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        username: username,
        phone: phone,
        first_name: firstName,    // তোমার Xano-তে যদি first_name ফিল্ড থাকে
        last_name: lastName,      // যদি last_name থাকে
        email: email || null,
        password: pass,           // যদি password ফিল্ড থাকে
        refer_code: refer_code
      })
    });

    const result = await response.json();

    if (response.ok && result.success === true) {
      // সাকসেস হলে
      localStorage.setItem('authToken', result.token || '');
      localStorage.setItem('currentUser', JSON.stringify(result.user || result));
      localStorage.setItem('isLoggedIn', 'true');

      const baseUrl = location.origin + location.pathname.split('/').slice(0, -1).join('/') + '/';
      const referLink = `\( {baseUrl}register.html?ref= \){username}`;

      document.getElementById('loginInfo').innerHTML = `
        ইউজারনেম: <b>${username}</b><br>
        পাসওয়ার্ড: <b>${pass}</b><br>
        নাম: <b>\( {firstName} \){lastName}</b>
      `;
      document.getElementById('myRefLink').innerText = referLink;
      document.getElementById('success').style.display = 'flex';

    } else {
      msg.innerHTML = result.message || "ইউজারনেম বা ফোন নাম্বার আগে থেকে রেজিস্টার করা আছে!";
      btn.disabled = false;
      btn.innerText = 'রেজিস্টার করুন';
    }
  } catch (err) {
    msg.innerHTML = 'ইন্টারনেট সমস্যা বা সার্ভার ডাউন! আবার চেষ্টা করো।';
    btn.disabled = false;
    btn.innerText = 'রেজিস্টার করুন';
  }
}

function copyLink() {
  const link = document.getElementById('myRefLink').innerText;
  navigator.clipboard.writeText(link).then(() => alert('রেফার লিংক কপি হয়েছে!'));
}

function goDashboard() {
  location.href = 'dashboard.html';
}

// স্পেস ব্যাকগ্রাউন্ড অ্যানিমেশন
const canvas = document.getElementById('spaceBg');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
const stars = [];
for(let i=0; i<1200; i++) stars.push({x:Math.random()*w, y:Math.random()*h, size:Math.random()*2.5, speed:Math.random()*1.2+0.3});
let nebulaAngle = 0;
const planet = {x:w*0.78, y:h*0.22, radius:110};

function draw() {
  ctx.fillStyle = 'rgba(10,0,30,0.06)'; ctx.fillRect(0,0,w,h);
  ctx.save(); ctx.translate(w/2,h/2); ctx.rotate(nebulaAngle);
  const grad = ctx.createRadialGradient(0,0,0,0,0,900);
  grad.addColorStop(0,'rgba(100,0,255,0.5)'); grad.addColorStop(0.5,'rgba(0,212,255,0.3)'); grad.addColorStop(1,'transparent');
  ctx.fillStyle = grad; ctx.fillRect(-1200,-1200,2400,2400); ctx.restore();
  nebulaAngle += 0.0006;

  const pg = ctx.createRadialGradient(planet.x,planet.y,planet.radius*0.3,planet.x,planet.y,planet.radius);
  pg.addColorStop(0,'#f0f8ff'); pg.addColorStop(0.7,'#88c'); pg.addColorStop(1,'#226');
  ctx.fillStyle = pg; ctx.beginPath(); ctx.arc(planet.x,planet.y,planet.radius,0,Math.PI*2); ctx.fill();

  ctx.fillStyle = '#fff';
  stars.forEach(s => { ctx.beginPath(); ctx.arc(s.x,s.y,s.size,0,Math.PI*2); ctx.fill(); s.x -= s.speed; if(s.x < 0) s.x = w; });
  requestAnimationFrame(draw);
}
draw();
window.addEventListener('resize', () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; });
</script>

</body>
</html>