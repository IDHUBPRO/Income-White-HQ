<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>ইনকাম রিপোর্ট / পাসবুক - Income White HQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:'Segoe UI',Arial,sans-serif;color:#fff;min-height:100vh;position:relative;overflow:hidden;background:#0a001f}
    canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1;opacity:0.7}
    .menu-btn{position:fixed;top:15px;left:15px;background:#00d4ff;color:#fff;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;z-index:9999;box-shadow:0 8px 25px rgba(0,212,255,0.6)}
    .drawer{position:fixed;top:0;left:-300px;width:280px;height:100%;background:rgba(255,255,255,0.98);border-right:5px solid #00d4ff;transition:0.4s;z-index:9999;padding:80px 20px 20px;overflow-y:auto}
    .drawer a{display:block;padding:18px 22px;color:#00d4ff;font-size:19px;font-weight:bold;text-decoration:none;border-bottom:1px solid #eee}
    .drawer a:hover{background:#00d4ff;color:#fff}
    .close-btn{position:absolute;top:15px;right:15px;font-size:38px;cursor:pointer;color:#00d4ff}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;z-index:9998}
    .header{background:linear-gradient(135deg,#00d4ff,#8b3dff);color:#fff;padding:28px;text-align:center;font-size:30px;font-weight:bold;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
    .container{max-width:580px;margin:20px auto;padding:20px}
    .card{background:rgba(255,255,255,0.95);backdrop-filter:blur(15px);border-radius:25px;padding:28px;margin:20px 0;box-shadow:0 20px 50px rgba(0,212,255,0.4);border:4px solid #00d4ff;overflow:hidden;color:#333}
    .filter{background:rgba(227,242,253,0.95);padding:18px;border-radius:18px;margin-bottom:25px;text-align:center}
    .filter select,.filter button{padding:14px 18px;border-radius:14px;border:none;margin:6px;font-size:17px;font-weight:bold}
    .filter button{background:#00d4ff;color:#fff;cursor:pointer;box-shadow:0 6px 20px rgba(0,212,255,0.4)}
    table{width:100%;border-collapse:collapse;margin-top:15px}
    th{background:linear-gradient(135deg,#00d4ff,#0088cc);color:#fff;padding:18px;text-align:center;font-size:17px;font-weight:bold}
    td{padding:16px 10px;text-align:center;border-bottom:2px solid rgba(0,212,255,0.2);font-size:16px}
    tr:hover{background:rgba(0,212,255,0.1)}
    .type{padding:8px 18px;border-radius:30px;font-size:14px;font-weight:bold;color:#fff}
    .random{background:#ff5722}
    .regular{background:#4caf50}
    .premium{background:#9c27b0}
    .refer{background:#ff9800}
    .deposit{background:#2196f3}
    .withdraw{background:#f44336}
    .status{padding:7px 16px;border-radius:30px;font-size:14px;font-weight:bold}
    .approved{background:#d4edda;color:#155724}
    .pending{background:#fff3cd;color:#856404}
    .rejected{background:#f8d7da;color:#721c24}
    .amount{font-weight:900;font-size:18px}
    .plus{color:#00aa00}
    .minus{color:#c00}
    .no-data{padding:60px;text-align:center;color:#aaa;font-size:20px}
  </style>
</head>
<body>

<canvas id="spaceBg"></canvas>

<div class="menu-btn" onclick="openDrawer()">Menu</div>
<div class="drawer" id="sideDrawer"><div class="close-btn" onclick="closeDrawer()">×</div><div id="drawerLinks"></div></div>
<div class="overlay" onclick="closeDrawer()"></div>

<div class="header">ইনকাম রিপোর্ট / পাসবুক</div>

<div class="container">

  <div class="card">
    <div class="filter">
      <select id="filterType">
        <option value="all">সব ধরনের লেনদেন</option>
        <option value="random">র‍্যান্ডম টাস্ক</option>
        <option value="regular">রেগুলার টাস্ক</option>
        <option value="premium">প্রিমিয়াম টাস্ক</option>
        <option value="refer">রেফার ইনকাম</option>
        <option value="deposit">ডিপোজিট</option>
        <option value="withdraw">উইথড্র</option>
      </select>
      <button onclick="applyFilter()">ফিল্টার করুন</button>
      <button onclick="location.reload()">রিসেট</button>
    </div>

    <div id="passbookTable">
      <div class="no-data">লোড হচ্ছে...</div>
    </div>
  </div>

</div>

<script src="config.js"></script>
<script src="functions.js"></script>
<script>
checkLogin();

let currentUser = null;

async function init() {
  currentUser = await getCurrentUser();
  if (!currentUser) return;
  loadPassbook();
}
init();

// মেনু
function openDrawer(){document.getElementById('sideDrawer').style.left='0';document.querySelector('.overlay').style.display='block';}
function closeDrawer(){document.getElementById('sideDrawer').style.left='-300px';document.querySelector('.overlay').style.display='none';}
document.getElementById('drawerLinks').innerHTML = `
  <a href="dashboard.html">ড্যাশবোর্ড</a>
  <a href="random-tasks.html">Random Tasks</a>
  <a href="regular-tasks.html">রেগুলার টাস্ক</a>
  <a href="premium-tasks.html">প্রিমিয়াম টাস্ক</a>
  <a href="refer.html">আমার রেফার</a>
  <a href="passbook.html">পাসবুক</a>
  <a href="withdraw.html">উইথড্র</a>
  <a href="profile.html">প্রোফাইল</a>
  <a href="#" onclick="logout()" style="color:#c00">লগআউট</a>
`;

// পাসবুক লোড
async function loadPassbook(filter = 'all') {
  try {
    const res = await db.listDocuments(DATABASE_ID, 'transactions', [
      Appwrite.Query.equal('user_id', currentUser.$id),
      Appwrite.Query.orderDesc('$createdAt')
    ]);

    let data = res.documents;
    if (filter !== 'all') {
      data = data.filter(t => t.type === filter);
    }

    const table = document.getElementById('passbookTable');
    if (data.length === 0) {
      table.innerHTML = '<div class="no-data">কোনো লেনদেন পাওয়া যায়নি</div>';
      return;
    }

    const typeBn = {
      random: 'র‍্যান্ডম', regular: 'রেগুলার', premium: 'প্রিমিয়াম',
      refer: 'রেফার', deposit: 'ডিপোজিট', withdraw: 'উইথড্র'
    };
    const statusBn = {approved: 'এপ্রুভড', pending: 'পেন্ডিং', rejected: 'রিজেক্টেড'};

    let html = `<table>
      <tr><th>তারিখ</th><th>ধরন</th><th>পরিমাণ</th><th>স্ট্যাটাস</th><th>বিবরণ</th></tr>`;

    data.forEach(t => {
      const sign = t.amount > 0 ? '+' : '';
      const amountClass = t.amount > 0 ? 'plus' : 'minus';
      html += `<tr>
        <td>${formatDate(t.$createdAt)}</td>
        <td><span class="type \( {t.type}"> \){typeBn[t.type] || t.type}</span></td>
        <td class="amount \( {amountClass}"> \){sign}${t.amount} HQ</td>
        <td><span class="status \( {t.status}"> \){statusBn[t.status] || t.status}</span></td>
        <td>${t.note || '-'}</td>
      </tr>`;
    });
    html += `</table>`;
    table.innerHTML = html;
  } catch (e) {
    document.getElementById('passbookTable').innerHTML = '<div class="no-data" style="color:#f00">ইন্টারনেট সমস্যা!</div>';
  }
}

function applyFilter() {
  const type = document.getElementById('filterType').value;
  loadPassbook(type);
}

// ব্যাকগ্রাউন্ড
const canvas = document.getElementById('spaceBg');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
const stars = [];
for(let i=0;i<1300;i++) stars.push({x:Math.random()*w,y:Math.random()*h,size:Math.random()*2.5,speed:Math.random()*1+0.3});
let nebulaAngle = 0;
function draw(){
  ctx.fillStyle='rgba(0,0,20,0.04)'; ctx.fillRect(0,0,w,h);
  ctx.save(); ctx.translate(w/2,h/2); ctx.rotate(nebulaAngle);
  const g=ctx.createRadialGradient(0,0,0,0,0,800);
  g.addColorStop(0,'rgba(0,212,255,0.4)'); g.addColorStop(0.5,'rgba(0,150,200,0.25)'); g.addColorStop(1,'transparent');
  ctx.fillStyle=g; ctx.fillRect(-1200,-1200,2400,2400); ctx.restore(); nebulaAngle+=0.0006;
  ctx.fillStyle='#fff'; stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.size,0,Math.PI*2);ctx.fill();s.x-=s.speed;if(s.x<0)s.x=w;});
  requestAnimationFrame(draw);
}
draw();
window.addEventListener('resize',()=>{w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;});
</script>

</body>
</html>