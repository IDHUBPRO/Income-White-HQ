<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8">
  <title>প্রিমিয়াম টাস্ক - Income White HQ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:Arial;color:#fff;min-height:100vh;position:relative;overflow:hidden}
    canvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:-1}
    .menu-btn{position:fixed;top:15px;left:15px;background:#8b3dff;color:#fff;width:50px;height:50px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px;cursor:pointer;z-index:9999;box-shadow:0 8px 25px rgba(139,61,255,0.6)}
    .drawer{position:fixed;top:0;left:-300px;width:280px;height:100%;background:rgba(255,255,255,0.98);border-right:5px solid #8b3dff;transition:0.4s;z-index:9999;padding:80px 20px 20px;overflow-y:auto}
    .drawer a{display:block;padding:18px 22px;color:#8b3dff;font-size:19px;font-weight:bold;text-decoration:none;border-bottom:1px solid #eee}
    .drawer a:hover{background:#8b3dff;color:#fff}
    .close-btn{position:absolute;top:15px;right:15px;font-size:38px;cursor:pointer;color:#8b3dff}
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.92);display:none;z-index:9998}
    .header{background:linear-gradient(135deg,#8b3dff,#00d4ff);color:#fff;padding:28px;text-align:center;font-size:30px;font-weight:bold;box-shadow:0 10px 30px rgba(0,0,0,0.4)}
    .container{max-width:520px;margin:20px auto;padding:20px}
    .premium-box{background:linear-gradient(135deg,#8b3dff,#00d4ff);color:#fff;padding:28px;border-radius:25px;text-align:center;margin:20px 0;box-shadow:0 15px 40px rgba(139,61,255,0.4)}
    .ad-card{background:rgba(255,255,255,0.95);backdrop-filter:blur(15px);border-radius:22px;padding:25px;margin:18px 0;box-shadow:0 15px 40px rgba(139,61,255,0.4);border:4px solid #8b3dff;text-align:center;position:relative;overflow:hidden}
    .ad-card::before{content:"";position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:linear-gradient(45deg,transparent,#8b3dff30,transparent);animation:glow 6s linear infinite}
    @keyframes glow{0%{transform:translateX(-100%) translateY(-100%) rotate(30deg)}100%{transform:translateX(100%) translateY(100%) rotate(30deg)}}
    .reward{font-size:28px;font-weight:bold;color:#8b3dff;margin:18px 0}
    .btn{background:#8b3dff;color:#fff;padding:18px;border:none;border-radius:16px;width:100%;font-size:20px;font-weight:bold;cursor:pointer;margin-top:15px;box-shadow:0 8px 25px rgba(139,61,255,0.4)}
    .btn:disabled{background:#666;color:#999;cursor:not-allowed;opacity:0.7}
    .countdown{font-size:52px;color:#8b3dff;font-weight:900;margin:20px 0}
    .daily{font-size:20px;background:rgba(255,255,255,0.95);color:#8b3dff;padding:18px;border-radius:18px;margin:20px 0;text-align:center;font-weight:bold;border:4px solid #8b3dff}
    .completed{color:#00aa00;font-weight:bold;font-size:19px;margin-top:12px}
  </style>
</head>
<body>

<!-- লাইভ স্পেস ব্যাকগ্রাউন্ড -->
<canvas id="spaceBg"></canvas>

<div class="menu-btn" onclick="openDrawer()">Menu</div>
<div class="drawer" id="sideDrawer"><div class="close-btn" onclick="closeDrawer()">X</div><div id="drawerLinks"></div></div>
<div class="overlay" onclick="closeDrawer()"></div>

<div class="header">প্রিমিয়াম টাস্ক</div>

<div class="container">
  <div class="premium-box">
    <h2 id="packageName">লোড হচ্ছে...</h2>
    <p id="expireInfo">মেয়াদ: লোড হচ্ছে...</p>
  </div>

  <div class="daily" id="dailyStatus">আজকের অ্যাড: 0 / 0</div>
  <div id="adList"><div style="text-align:center;padding:40px;color:#8b3dff">লোড হচ্ছে...</div></div>
</div>

<!-- অ্যাড মোডাল -->
<div id="adModal" style="position:fixed;inset:0;background:rgba(0,0,0,0.96);display:none;align-items:center;justify-content:center;z-index:99999;flex-direction:column;color:#fff;padding:20px">
  <h2 style="color:#8b3dff;font-size:28px">অ্যাড দেখুন – ১০ সেকেন্ড</h2>
  <iframe id="adFrame" width="95%" height="420" style="border-radius:18px;border:4px solid #8b3dff" frameborder="0"></iframe>
  <div class="countdown" id="timer">10</div>
  <button class="btn" id="completeBtn" disabled>কমপ্লিট করুন</button>
</div>

<script>
const BASE_URL = "https://x8ki-letl-twmt.n7.xano.io/api:wsicKubT";

if(!localStorage.getItem('isLoggedIn')) { alert('লগইন করুন!'); location.href='login.html'; }
const user = JSON.parse(localStorage.getItem('currentUser') || '{}');

// প্রিমিয়াম চেক
if(!user.is_premium || new Date(user.premium_expiry) < new Date()) {
  alert('তোমার প্রিমিয়াম মেম্বারশিপ নেই বা মেয়াদ শেষ হয়েছে!');
  location.href='packages.html';
}

// মেনু
function openDrawer(){document.getElementById('sideDrawer').style.left='0';document.querySelector('.overlay').style.display='block';}
function closeDrawer(){document.getElementById('sideDrawer').style.left='-300px';document.querySelector('.overlay').style.display='none';}
document.getElementById('drawerLinks').innerHTML = `
  <a href="dashboard.html">ড্যাশবোর্ড</a>
  <a href="random-tasks.html">Random Tasks</a>
  <a href="regular-tasks.html">রেগুলার টাক্স</a>
  <a href="premium-tasks.html">প্রিমিয়াম টাস্ক</a>
  <a href="refer.html">আমার রেফার</a>
  <a href="withdraw.html">উইথড্র</a>
  <a href="profile.html">প্রোফাইল</a>
  <a href="#" onclick="if(confirm('লগআউট করবেন?')){localStorage.clear();location.href='index.html'}">লগআউট</a>`;

// প্যাকেজ কনফিগ
const packages = {
  1000:   {name:"সিলভার",     dailyLimit:2,  reward:100},
  5000:   {name:"গোল্ড",       dailyLimit:10, reward:50},
  10000:  {name:"ডায়মন্ড",    dailyLimit:22, reward:50},
  30000:  {name:"প্লাটিনাম",  dailyLimit:70, reward:70},
  50000:  {name:"এলিট",       dailyLimit:55, reward:100},
  100000: {name:"লিজেন্ড",    dailyLimit:60, reward:200}
};

async function loadPremiumData() {
  try {
    const res = await fetch(BASE_URL + "/get_premium_status?user_id=" + user.id);
    const data = await res.json();

    const pkg = packages[data.premium_package] || packages[1000];

    document.getElementById('packageName').innerText = pkg.name + " প্যাকেজ";
    document.getElementById('expireInfo').innerText = "মেয়াদ: " + new Date(data.premium_expiry).toLocaleDateString('bn-BD');
    document.getElementById('dailyStatus').innerText = `আজকের অ্যাড: \( {data.today_completed} / \){pkg.dailyLimit}`;

    const adList = document.getElementById('adList');
    const remaining = pkg.dailyLimit - data.today_completed;

    if(remaining <= 0){
      adList.innerHTML = `<div class="ad-card"><h3 style="color:#00aa00">আজকের সব অ্যাড কমপ্লিট!</h3><p>কাল আবার চলে আসো</p></div>`;
    } else {
      adList.innerHTML = '';
      for(let i = 1; i <= remaining; i++){
        adList.innerHTML += `
          <div class="ad-card">
            <h3>প্রিমিয়াম অ্যাড #${i}</h3>
            <div class="reward">পুরস্কার: ${pkg.reward} HQ</div>
            <button class="btn" onclick="watchAd(\( {i}, \){pkg.reward})">অ্যাড দেখুন</button>
          </div>`;
      }
    }
  } catch(e) {
    document.getElementById('adList').innerHTML = '<div class="ad-card" style="color:#f00">ইন্টারনেট সমস্যা!</div>';
  }
}

function watchAd(adNumber, reward){
  document.getElementById('adFrame').src = "https://youtube.com/embed/dQw4w9WgXcQ?autoplay=1&mute=1";
  document.getElementById('adModal').style.display = 'flex';

  let time = 10;
  document.getElementById('timer').innerText = time;
  document.getElementById('completeBtn').disabled = true;

  const timer = setInterval(() => {
    time--;
    document.getElementById('timer').innerText = time;
    if(time <= 0){
      clearInterval(timer);
      document.getElementById('completeBtn').disabled = false;
      document.getElementById('completeBtn').onclick = async () => {
        try {
          const res = await fetch(BASE_URL + "/complete_premium_ad", {
            method: "POST",
            headers: {"Content-Type":"application/json"},
            body: JSON.stringify({user_id: user.id, reward: reward})
          });
          if(res.ok){
            alert(`অভিনন্দন! +${reward} HQ যোগ হয়েছে`);
            document.getElementById('adModal').style.display = 'none';
            loadPremiumData();
          }
        } catch(e) { alert('সমস্যা হয়েছে!'); }
      };
    }
  }, 1000);
}

loadPremiumData();

// লাইভ স্পেস ব্যাকগ্রাউন্ড
const canvas = document.getElementById('spaceBg');
const ctx = canvas.getContext('2d');
let w = canvas.width = window.innerWidth;
let h = canvas.height = window.innerHeight;
const stars = []; for(let i=0;i<1200;i++) stars.push({x:Math.random()*w,y:Math.random()*h,size:Math.random()*2.5,speed:Math.random()*1+0.3});
let nebulaAngle = 0;
const planet = {x:w*0.75,y:h*0.25,radius:100};

function draw(){
  ctx.fillStyle='rgba(0,0,20,0.04)'; ctx.fillRect(0,0,w,h);
  ctx.save(); ctx.translate(w/2,h/2); ctx.rotate(nebulaAngle);
  const g=ctx.createRadialGradient(0,0,0,0,0,800);
  g.addColorStop(0,'rgba(139,61,255,0.4)'); g.addColorStop(0.5,'rgba(100,0,200,0.25)'); g.addColorStop(1,'transparent');
  ctx.fillStyle=g; ctx.fillRect(-1200,-1200,2400,2400); ctx.restore(); nebulaAngle+=0.0006;
  const pg=ctx.createRadialGradient(planet.x,planet.y,planet.radius*0.3,planet.x,planet.y,planet.radius);
  pg.addColorStop(0,'#f0f0f0'); pg.addColorStop(0.7,'#888'); pg.addColorStop(1,'#333');
  ctx.fillStyle=pg; ctx.beginPath(); ctx.arc(planet.x,planet.y,planet.radius,0,Math.PI*2); ctx.fill();
  ctx.fillStyle='#fff'; stars.forEach(s=>{ctx.beginPath();ctx.arc(s.x,s.y,s.size,0,Math.PI*2);ctx.fill();s.x-=s.speed;if(s.x<0)s.x=w;});
  requestAnimationFrame(draw);
}
draw();
window.addEventListener('resize',()=>{w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;});
</script>

</body>
</html>